<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF 簽到測試</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
        #status { color: red; margin-top: 20px; }
        button { padding: 10px 20px; background: #00B900; color: white; border: none; border-radius: 5px; font-size: 16px; }
    </style>
</head>
<body>
    <h2>LINE LIFF 資料回傳測試</h2>
    <div id="content">
        <p>讀取中...</p>
    </div>
    <p id="status"></p>

    <script>
        // ==========================================
        // 請在這裡填入你的資訊
        // ==========================================
        const MY_LIFF_ID = "請填入你的LIFF_ID";  // 暫時先空著，等第三階段拿到再填
        const MY_GAS_URL = "請填入剛剛複製的GAS網址"; // 把第一階段的 GAS 網址貼在這裡
        // ==========================================

        document.addEventListener('DOMContentLoaded', function() {
            liff.init({ liffId: MY_LIFF_ID })
                .then(() => {
                    if (!liff.isLoggedIn()) {
                        liff.login();
                    } else {
                        runApp();
                    }
                })
                .catch((err) => {
                    document.getElementById('status').innerText = "LIFF 初始化失敗: " + err;
                });
        });

        function runApp() {
            liff.getProfile().then(profile => {
                // 1. 顯示在畫面上
                document.getElementById('content').innerHTML = `
                    <p>哈囉，<b>${profile.displayName}</b></p>
                    <p>你的 ID 是：${profile.userId}</p>
                    <button onclick="sendData('${profile.userId}', '${profile.displayName}')">點我簽到</button>
                `;
            }).catch(err => {
                document.getElementById('status').innerText = "取得資料失敗: " + err;
            });
        }

        function sendData(userId, displayName) {
            document.getElementById('status').innerText = "正在傳送資料...";
            
            fetch(MY_GAS_URL, {
                method: 'POST',
                body: JSON.stringify({ userId: userId, displayName: displayName }),
                mode: 'no-cors', // 重要：跨域傳輸設定
                headers: { 'Content-Type': 'application/json' }
            }).then(() => {
                document.getElementById('status').innerText = "✅ 簽到成功！請檢查 Google Sheet";
                document.getElementById('status').style.color = "green";
            }).catch(err => {
                document.getElementById('status').innerText = "❌ 傳送失敗";
            });
        }
    </script>
</body>
</html>